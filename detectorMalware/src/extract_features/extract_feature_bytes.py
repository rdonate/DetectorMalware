#! - * - coding UTF-8 - * -
import zipfile
def extract_Feature_Byte(db, dir_Data_Raw, source, order):
    collection_bytes = db.selectCollection('bytes')
    collection_total = db.selectCollection('total')
    with zipfile.ZipFile(dir_Data_Raw,'r') as input_file:
        text=input_file.read(source[0]+'.bytes').decode()
    lines=text.split('\r\n')
    all_elems_codes=[]
    ngrams={}
    for line in lines:
        elems=line.split(' ')
        all_elems_codes.extend(elems[1:])
    for a in range(len(all_elems_codes)-order+1):
        ngram=all_elems_codes[a]
        for x in range(a+1, a + order):
            ngram += " " + all_elems_codes[x]
        if ngram in ngrams:
            ngrams[ngram]+=1
        else:
            ngrams[ngram]=1
    del ngram, all_elems_codes, line
    total_ngrams=0
    for ngram in ngrams.keys():
        total_ngrams+=ngrams[ngram]
        data = {'file': source[0], 'ngram': ngram, 'count': ngrams[ngram]}
        if len(source)==2:
            data['class']= source[1]
        collection_bytes.insert(data)
    data = collection_total.find_one({'_id':source[0]})
    data['ngrams']=total_ngrams
    collection_total.save(data)
    input_file.close()
    del ngrams, collection_bytes, collection_total, data, total_ngrams, lines,text
